要了解程序的性能首先要知道如何测试它。程序的性能由低到高可以分成多个层级，因此它并非是一个“是”或“否”的问题。

性能问题难以跟踪或复现，因为它受到多重因素的影响。正因如此，很难从性能测试结果中得到正确的结论。有时，改动一个看似无关的部分可能会使性能大幅波动。这种现象被称为统计偏差。所以，在测试性能的时候常常需要引入统计学方法，在这个领域已经有大量的研究进展，这本书中不能穷尽，而只是介绍一些大体上的思路和方向。

为了得到准确、有意义的结果必须进行公平的实验，设计测试内容和配置测试环境是其中非常重要的两部分。本章会介绍现代系统的性能测试结果为何会带有噪声以及我们如何解决它们。我们还将介绍在实际生产环境中进行性能测试的重要性。

本章章末会介绍硬件/软件时钟，开发者们可以用它们来进行基于用时的测试。此外我们还会提到设计和编写合格的微性能测试时的一些注意事项。

## 系统噪声

软件和硬件中有很多意图提升性能的特性，但他们有时会带来不确定性行为。比如DFS(Dynamic Freq Scaling)会允许CPU在短时间内提升频率大幅提升运行速度。但是这种特性很大程度上依赖于CPU温度，因此难以预测。运行两个完全的benchmark，一次CPU经历了超频再降频的过程，另一次CPU全程标准频率运行，这会使得性能不稳定，尤其是在笔记本电脑这种散热不良的平台上这种现象更为明显。

同样，软件特性也会产生影响。如文件系统中的cache，在一组文件操作中，第一次操作由于cache miss的原因性能会很低，而在预热之后，后续的操作则可能得到很高的性能。

不仅如此，Unix environment size和将目标文件提交给链接器的顺序也有可能对性能产生不可预测的影响。另外，还有很多因素会影响内存布局并可能间接影响性能。曾有一种在统计学意义上准确的性能测试方法，但是也很初步，现在已经不再使用了。

> 作者个人经验：注意某些任务管理器（如Linux top）也会影响性能测试结果因为某些核会被激活并执行该进程。这可能会影响实际运行benchmark的核的频率。



## 生产环境中的性能测试

## 性能衰退的自动检测

## 手动性能测试

## 软件和硬件时钟

## 微性能测试

## 本章总结